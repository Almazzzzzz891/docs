# Signum Video - Website
### Навигация
- [API](api/README.md)
  - [Примеры](api/examples.md)

## **Получение прямой трансляции с камеры**
Запрос на начало прямой трансляции с камеры. В случае успешного выполнения возвращает ссылку на HLS поток

### **Запрос**
```GET /api/live/<camera id>```

### **Параметры запроса**
| Параметр  | Доступные значения    | По умолчанию | Описание                  |
|-----------|-----------------------|--------------|---------------------------|
| `quality` | `high` `medium` `low` | `high`       | Выбор качества трансляции |

### **Ответ**
```json
{
  "pbUrl": <String> // ссылка на поток
}
```
### **Пример запроса**
```GET /api/live/2?quality=medium```

## **Получение записи из архива**
Запрос на начало трансляции архива с камеры. В случае успешного выполнения - возвращает ссылку на HLS поток.
Есть 3 варианта передачи параметров:
- Название файла и время в миллисекундах от начала записи
- Название файла
- Время записи в миллисекундах

### **Запрос**
```GET /api/archive/<camera id>```

### **Параметры запроса**
| Параметр   | Доступные значения    | По умолчанию | Описание                                 |
|------------|-----------------------|--------------|------------------------------------------|
| `quality`  | `high` `medium` `low` | `high`       | Выбор качества трансляции                |
| `filename` |                       |              | Выбор файла для трансляции               |
| `time`     |                       |              | Время записи или время  от начала записи |

### **Ответ**
```json
{
  "pbUrl": <String> // ссылка на поток
}
```
### **Примеры запроса**
Начать трансляцию файла qwerty.mp4 с 23.5сек у второй камеры
```
GET /api/archive/2?filename=qwerty.mp4&time=23500
```

Начать трансляцию файла qwerty.mp4 в среднем качестве у второй камеры
```
GET /api/archive/2?quality=medium&filename=qwerty.mp4
```

Начать трансляцию архива с момента 1621412462741 (May 19 2021 08:21:02) в низком качестве у второй камеры
```
GET /api/archive/2?quality=low&time=1621412462741
```

## **Получение файла из архива**
Запрос на загрузку файла из архива. Фактически просто подставляет адрес сервера и
возвращает результат обратно, поэтому нужно следить чтобы название файла было
корректным.

### **Запрос**
```GET /api/download/<camera id>/<filename>```

### **Ответ**
```json
{
  "downloadUrl": <String> // ссылка на загрузку
}
```
### **Пример запроса**
```GET /api/download/6/qwerty.mp4```

## **Получение записей с камеры из архива**
Запрос на получение всех доступных записей с камеры.

### **Запрос**
```GET /api/records/<camera id>```

### **Ответ**
```json
[
  {
  "durSec": <String>,   // Длительность в секундах, например "300.914626"
  "end": <String>,      // Время конца записи, например "2021-05-19 13:46:11.280381 +0000 +0000"
  "fileName": <String>, // Название файла "16806b24801ba607.mp4"
  "start": <String>     // Время начала записи "2021-05-19 13:41:10.365755 +0000 +0000"
  },
  // .. etc
]
```

## **Получение списка камер**
Запрос на получение доступных пользователю камер.

### **Запрос**
```GET /api/cameras```

## **Ответ**
```json
{
  "cameras": [
    {
      "host": <String>, // IP камеры, например "192.168.1.191" 
      "id": <String>,   // ID камеры, например "6"
      "name": <String>  // Название камеры, например "c191"
    },
    {
      "host": <String>,
      "id": <String>,
      "name": <String>
    },
    // .. etc
  ]
}
```

## **Получение картинки с камер**
Запрос на получение ссылки на изображения с камер

### **Запрос**
```GET /api/snapshot```

### **Параметры запроса**
| Параметр | Описание                             |
|----------|--------------------------------------|
| `cid`    | ID камеры (можно передать несколько) |

### **Ответ**
```json
{
  "method": <String>,      // HTTP метод для выполнения запроса, например "GET"
  "snapshotUrls": <String> // ссылка на получение снапшотов, например "https://hosting/p/snapshot?key=ccd5c9ed&key=gui82jga"
}
```
Выполнив соответствующий запрос по этому URL, в качестве ответа вернется
```json
[
  {
    "cameraId": <String>, // ID камеры, например "6"
    "data": <String>,     // Данные изображения в виде байтов
    "mime": <String>      // MimeType изображения, например "image/png"
  },
  // .. etc
]
```

### **Примеры**
```
GET /api/snapshot?cid=2
GET /api/snapshot?cid=3&cid=4&cid=5&cid=6
```


## Получить информацию о пользователе
Запрос на получение информации о пользователе

### **Запрос**
```GET /api/who-im```

### **Ответ**
```json
{
  "id": "609cb8d15b6ab52bd6af47d5", // ID пользователя
  "email": "local@signum.video", // Email пользователя
  "address": "Офис", // Физический адрес пользователя
  "serverAddress": "http://127.0.0.1:21020", // Адрес сервера пользователя
  "iat": 1621419627,
  "exp": 1621506027
}
```